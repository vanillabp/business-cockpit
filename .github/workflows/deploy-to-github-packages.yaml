name: Publish to GitHub Packages
on: push
jobs:
  delete-snapshot-npm-package-1:
    runs-on: ubuntu-latest
    continue-on-error: true
    permissions:
      contents: read
      packages: write
    steps:
      - id: get-version
        uses: jactions/maven-version@v1.2.0
      - run: |
          the_secret=${{ steps.get-version.outputs.version }}
          echo "::notice::$the_secret"
      - uses: actions/delete-package-versions@v4.1.1
        with:
          package-name: 'bc-official-gui-client'
          package-type: 'npm'
          package-version-ids: ${{ steps.get-version.outputs.version }}
  delete-snapshot-npm-package-2:
    runs-on: ubuntu-latest
    continue-on-error: true
    needs: delete-snapshot-npm-package-1
    permissions:
      contents: read
      packages: write
    steps:
      - name: Set Release version env variable
        run: |
          echo "RELEASE_VERSION=$(mvn help:evaluate -Dexpression=project.version -q -DforceStdout)" >> $GITHUB_ENV
      - uses: actions/delete-package-versions@v4.1.1
        with:
          package-name: 'bc-shared'
          package-type: 'npm'
          package-version-ids: ${{ env.RELEASE_VERSION }}
  delete-snapshot-npm-package-3:
    runs-on: ubuntu-latest
    continue-on-error: true
    needs: delete-snapshot-npm-package-2
    permissions:
      contents: read
      packages: write
    steps:
      - name: Set Release version env variable
        run: |
          echo "RELEASE_VERSION=$(mvn help:evaluate -Dexpression=project.version -q -DforceStdout)" >> $GITHUB_ENV
      - uses: actions/delete-package-versions@v4.1.1
        with:
          package-name: 'bc-ui'
          package-type: 'npm'
          package-version-ids: ${{ env.RELEASE_VERSION }}
  delete-snapshot-npm-package-4:
    runs-on: ubuntu-latest
    continue-on-error: true
    needs: delete-snapshot-npm-package-3
    permissions:
      contents: read
      packages: write
    steps:
      - name: Set Release version env variable
        run: |
          echo "RELEASE_VERSION=$(mvn help:evaluate -Dexpression=project.version -q -DforceStdout)" >> $GITHUB_ENV
      - uses: actions/delete-package-versions@v4.1.1
        with:
          package-name: 'bc-dev-shell'
          package-type: 'npm'
          package-version-ids: ${{ env.RELEASE_VERSION }}
